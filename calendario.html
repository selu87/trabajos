<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calendario con notas</title>
  <style>
    :root{ --blue:#ea9800; --bg:#f6f7fb; --card:#ffffff; --muted:#6b7280 }
    *{box-sizing:border-box;font-family:Inter,Segoe UI,Roboto,Arial,sans-serif}
    body{margin:0;background:var(--bg);color:#111}
    .app{max-width:980px;margin:32px auto;padding:20px}
    .header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    .title{display:flex;align-items:center;gap:16px}
    .logo{font-weight:700;color:var(--blue);font-size:20px}
    .controls{display:flex;gap:8px;align-items:center}
    button{background:var(--blue);color:#fff;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
    button.ghost{background:transparent;color:var(--blue);border:1px solid rgba(30,111,255,0.18)}
    .month{font-size:20px;font-weight:600}
    .calendar{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 6px 18px rgba(20,20,40,0.06)}
    .weeknames{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;margin-bottom:8px}
    .grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
    .cell{min-height:90px;border-radius:8px;padding:8px;background:linear-gradient(180deg,transparent,rgba(0,0,0,0.01));cursor:pointer;position:relative}
    .cell.other{opacity:0.45}
    .cell .date{position:absolute;top:8px;right:8px;font-size:12px;color:var(--muted)}
    .cell .notes-inline{margin-top:26px;display:flex;flex-direction:column;gap:6px}
    .badge{display:inline-block;padding:4px 6px;border-radius:6px;background:#eef6ff;font-size:12px;color:var(--blue);max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .footer{margin-top:12px;display:flex;justify-content:space-between;align-items:center}
    .search{padding:8px;border-radius:8px;border:1px solid #e6e9ef;background:#fff}
    /* modal */
    .modal-bg{position:fixed;inset:0;background:rgba(12,18,30,0.45);display:none;align-items:center;justify-content:center;padding:20px}
    .modal{width:100%;max-width:680px;background:var(--card);border-radius:12px;padding:18px}
    .row{display:flex;gap:8px;align-items:center}
    textarea{width:100%;min-height:110px;padding:10px;border-radius:8px;border:1px solid #e6e9ef}
    input[type=text]{padding:8px;border-radius:8px;border:1px solid #e6e9ef}
    .small{font-size:13px;color:var(--muted)}
    .note-list{display:flex;flex-direction:column;gap:8px;margin-top:10px}
    .note-item{padding:8px;border-radius:8px;border:1px solid #f1f4f9;background:#fbfdff;display:flex;justify-content:space-between;gap:10px}
    .note-actions{display:flex;gap:6px}
    .empty{padding:18px;text-align:center;color:var(--muted)}
    @media (max-width:700px){.cell{min-height:80px}}
  </style>
</head>		
<body>
  <div class="app">
    <div class="header">
      <div class="title">
        <div class="logo">Optron — Calendario</div>
        <div class="small">Anota tus tareas y recordatorios por día</div>
      </div>
      <div class="controls">
        <button id="prev">‹</button>
        <div class="month" id="monthLabel">Mes año</div>
        <button id="next">›</button>
        <button id="today" class="ghost">Hoy</button>
      </div>
    </div>

    <div class="calendar">
      <div class="weeknames" id="weekNames"></div>
      <div class="grid" id="daysGrid"></div>
    </div>

    <div class="footer">
      <input id="search" class="search" placeholder="Buscar notas..." />
      <div class="small">Notas guardadas en tu navegador (localStorage)</div>
    </div>
  </div>

  <div class="modal-bg" id="modalBg">
    <div class="modal" role="dialog" aria-modal="true">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <strong id="modalDate">Fecha</strong>
        <div>
          <button id="closeModal" class="ghost">Cerrar</button>
        </div>
      </div>

      <label class="small">Añadir una nota</label>
      <textarea id="noteText" placeholder="Describe la tarea o recordatorio..."></textarea>
      <div style="display:flex;gap:8px;margin-top:8px">
        <input id="noteTitle" type="text" placeholder="Título (opcional)" />
        <input id="noteTime" type="text" placeholder="Hora (ej. 15:30)" style="width:120px" />
      </div>
      <div style="display:flex;gap:8px;margin-top:10px;justify-content:flex-end">
        <button id="addNote">Guardar nota</button>
      </div>

      <hr style="margin:12px 0" />
      <div>
        <label class="small">Notas del día</label>
        <div id="notesList" class="note-list"></div>
      </div>
    </div>
  </div>

  <script>
    // Utilidades
    const weekDays = ['Lun','Mar','Mié','Jue','Vie','Sáb','Dom'];
    const monthNames = ['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];
    const key = 'calendar-notes-infosel';

    // Estado
    let current = new Date();
    let notes = JSON.parse(localStorage.getItem(key) || '{}');

    // Elementos
    const weekNamesEl = document.getElementById('weekNames');
    const daysGrid = document.getElementById('daysGrid');
    const monthLabel = document.getElementById('monthLabel');
    const prev = document.getElementById('prev');
    const next = document.getElementById('next');
    const todayBtn = document.getElementById('today');
    const modalBg = document.getElementById('modalBg');
    const modalDate = document.getElementById('modalDate');
    const noteText = document.getElementById('noteText');
    const noteTitle = document.getElementById('noteTitle');
    const noteTime = document.getElementById('noteTime');
    const addNoteBtn = document.getElementById('addNote');
    const notesList = document.getElementById('notesList');
    const closeModal = document.getElementById('closeModal');
    const search = document.getElementById('search');

    // Render week names
    weekDays.forEach(d=>{
      const el = document.createElement('div'); el.textContent = d; el.style.fontWeight='600'; el.style.padding='6px'; el.style.color='var(--muted)'; weekNamesEl.appendChild(el);
    });

    function startOfWeek(date){
      // Lunes como inicio
      const d = new Date(date); const day = (d.getDay()+6)%7; d.setDate(d.getDate()-day); d.setHours(0,0,0,0); return d;
    }

    function formatDateKey(d){
      const y = d.getFullYear(); const m = String(d.getMonth()+1).padStart(2,'0'); const day = String(d.getDate()).padStart(2,'0');
      return `${y}-${m}-${day}`;
    }

    function render(){
      daysGrid.innerHTML='';
      const year = current.getFullYear(); const month = current.getMonth();
      monthLabel.textContent = `${monthNames[month]} ${year}`;

      const firstOfMonth = new Date(year,month,1);
      const start = startOfWeek(firstOfMonth);
      // show 6 weeks = 42 cells
      const total = 42;
      for(let i=0;i<total;i++){
        const d = new Date(start); d.setDate(start.getDate()+i);
        const cell = document.createElement('div'); cell.className='cell';
        const keyD = formatDateKey(d);
        if(d.getMonth()!==month) cell.classList.add('other');
        const dateSpan = document.createElement('div'); dateSpan.className='date'; dateSpan.textContent = d.getDate(); cell.appendChild(dateSpan);

        // notes preview
        const dayNotes = notes[keyD] || [];
        const preview = document.createElement('div'); preview.className='notes-inline';
        dayNotes.slice(0,2).forEach(n=>{const b=document.createElement('div');b.className='badge';b.title=n.text; b.textContent = (n.time? n.time+' — ':'') + (n.title || n.text); preview.appendChild(b)});
        if(dayNotes.length>2){const more=document.createElement('div');more.className='small';more.textContent=`+${dayNotes.length-2} más`;preview.appendChild(more)}
        cell.appendChild(preview);

        cell.addEventListener('click',()=>openModalForDate(d));
        daysGrid.appendChild(cell);
      }
    }

    function openModalForDate(d){
      const keyD = formatDateKey(d);
      modalDate.textContent = `${d.getDate()} ${monthNames[d.getMonth()]} ${d.getFullYear()}`;
      noteText.value=''; noteTitle.value=''; noteTime.value=''; notesList.innerHTML='';
      modalBg.style.display='flex'; modalBg.scrollTop=0;

      const dayNotes = notes[keyD] || [];
      if(dayNotes.length===0){ notesList.innerHTML = '<div class="empty">No hay notas para este día</div>'; }
      else{
        dayNotes.forEach((n,idx)=>{
          const item = document.createElement('div'); item.className='note-item';
          const left = document.createElement('div'); left.style.flex='1'; left.innerHTML = `<strong>${n.title || (n.time? n.time : 'Nota')}</strong><div class="small">${n.time? n.time+' · ':''}${n.text}</div>`;
          const actions = document.createElement('div'); actions.className='note-actions';
          const del = document.createElement('button'); del.className='ghost'; del.textContent='Eliminar'; del.addEventListener('click',()=>{ if(confirm('Eliminar nota?')){ dayNotes.splice(idx,1); saveNotes(keyD,dayNotes); openModalForDate(d); } });
          const edit = document.createElement('button'); edit.textContent='Editar'; edit.addEventListener('click',()=>{ noteText.value=n.text; noteTitle.value=n.title||''; noteTime.value=n.time||''; dayNotes.splice(idx,1); saveNotes(keyD,dayNotes); render(); });
          actions.appendChild(edit); actions.appendChild(del);
          item.appendChild(left); item.appendChild(actions); notesList.appendChild(item);
        });
      }

      addNoteBtn.onclick = ()=>{
        const text = noteText.value.trim(); if(!text){ alert('Escribe algo en la nota'); return; }
        const newNote = { title: noteTitle.value.trim(), time: noteTime.value.trim(), text };
        const arr = notes[keyD] || [];
        arr.push(newNote);
        saveNotes(keyD,arr);
        openModalForDate(d);
        render();
      }
    }

    function saveNotes(dateKey,arr){
      if(arr.length===0) delete notes[dateKey]; else notes[dateKey]=arr;
      localStorage.setItem(key,JSON.stringify(notes));
    }

    prev.addEventListener('click',()=>{ current.setMonth(current.getMonth()-1); render(); });
    next.addEventListener('click',()=>{ current.setMonth(current.getMonth()+1); render(); });
    todayBtn.addEventListener('click',()=>{ current=new Date(); render(); });
    closeModal.addEventListener('click',()=>{ modalBg.style.display='none'; });
    modalBg.addEventListener('click',(e)=>{ if(e.target===modalBg) modalBg.style.display='none'; });

    // search
    search.addEventListener('input',()=>{
      const q = search.value.trim().toLowerCase(); if(!q){ render(); return; }
      daysGrid.innerHTML=''; monthLabel.textContent = 'Resultados de búsqueda';
      // buscar en notes
      const results = [];
      Object.keys(notes).forEach(k=>{
        notes[k].forEach(n=>{ if((n.title||'').toLowerCase().includes(q) || (n.text||'').toLowerCase().includes(q) || (n.time||'').toLowerCase().includes(q)) results.push({date:k,n}); })
      });
      if(results.length===0){ daysGrid.innerHTML = '<div class="empty">No se han encontrado notas.</div>'; return; }
      // mostrar resultados como tarjetas en la grid (1 columna x 7 to stay readable)
      results.forEach(r=>{
        const cell = document.createElement('div'); cell.className='cell'; cell.style.gridColumn='span 7';
        const d = new Date(r.date); const header = document.createElement('div'); header.className='date'; header.textContent = r.date;
        const left = document.createElement('div'); left.style.marginTop='18px'; left.innerHTML = `<strong>${r.n.title||r.n.time||'Nota'}</strong><div class="small">${r.n.time? r.n.time + ' · ':''}${r.n.text}</div>`;
        cell.appendChild(header); cell.appendChild(left);
        daysGrid.appendChild(cell);
      });
    });

    // init
    render();
  </script>
</body>
</html>
